(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty,d=[].slice;a=function(){function a(){}return a}(),null==window.Growlyflash&&(window.Growlyflash=a),a.defaults={align:"right",delay:4e3,dismiss:!0,spacing:10,target:"body",title:!1,type:null,"class":["alert","growlyflash","fade"],before_show:function(){return this.el.css(this.calc_css_position())}},a.KEY_MAPPING={alert:"warning",error:"danger",notice:"info",success:"success"},a.FlashStruct=function(){function b(b,c){this.msg=b,this.key=c,this.type=a.KEY_MAPPING[this.key]}return b.prototype.shown=!1,b.prototype.growl=function(){return $.growlyflash(this)},b.prototype.is_equal=function(a){return this.key===a.key&&this.msg===a.msg},b.prototype.isnt_equal=function(a){return!this.is_equal(a)},b}(),a.Alert=function(){function a(a,b){this.flash=a,this.title=b.title,this.align=b.align,this.dismiss=b.dismiss,this.msg=b.msg,this.spacing=b.spacing,this.type=b.type,this["class"]=b["class"],this.el=$("<div>",{"class":this._classes().join(" "),html:""+this._dismiss()+this._title()+this.msg}).appendTo(b.target),b.before_show.call(this,b),this.show(),b.delay&&setTimeout(function(a){return function(){return a.hide(function(){return $(this).remove()})}}(this),b.delay)}return a.prototype.show=function(){return this.el.toggleClass("in")},a.prototype.hide=function(a){return this.el.fadeOut(a)},a.prototype._classes=function(){var a;return this["class"].concat(function(){var b,c,d,e;for(d=[this.type],e=[],b=0,c=d.length;c>b;b++)a=d[b],null!=a&&e.push("alert-"+a);return e}.call(this),["growlyflash-"+this.align])},a.prototype._dismiss=function(){return null==this.dismiss?"":'<a class="close" data-dismiss="alert" href="#">&times;</a>'},a.prototype._title=function(){return this.title===!1?"":"<strong>"+this.type.charAt(0).toUpperCase()+this.type.substring(1)+"!</strong>"},a.prototype.calc_top_offset=function(){var a;return a=parseInt(this.el.css("top")),this.el.siblings(".growlyflash").each(function(b){return function(c,d){return a=Math.max(a,parseInt($(d).css("top"))+$(d).outerHeight()+b.spacing)}}(this)),a},a.prototype.calc_css_position=function(){var a;return a={},a.top=this.calc_top_offset()+"px","center"===this.align&&(a.marginLeft="-"+this.el.width()/2+"px"),a},a}(),$.growlyflash=function(b,c){var d,e;return null==c&&(c={}),e=$.extend(!0,{},a.defaults,{msg:b.msg,type:b.type},c),d=new a.Alert(b,e),b instanceof a.FlashStruct?b:d},a.Listener=function(){function c(a){null==this.stack&&(this.stack=new g),null!=window.flashes&&this.process_static(),$(a).on(e,function(a){return function(b,c){a.stack.push_once(i(c.getResponseHeader(f)))}}(this))}var e,f,g,h,i;return f="X-Message",e="ajax:complete ajaxComplete",g=function(a){function c(){var a;a=1<=arguments.length?d.call(arguments,0):[],this.splice.apply(this,[0,0].concat(d.call(a)))}return b(c,a),c.prototype.has_uniq_in=function(a,b){var c,d,e,f;if(null==b&&(b=0),!(this.length>0))return!0;f=this.slice(-a.length);for(d in a)e=a[d],("function"==typeof(c=f[d]).isnt_equal?c.isnt_equal(e):void 0)&&b++;return b>0},c.prototype.push_all=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.push(b.growl());return this},c.prototype.push_once=function(a){return this.has_uniq_in(a)&&this.push_all(a),this.purge()},c.prototype.purge=function(){return setTimeout(function(a){return function(){return a.splice(0)}}(this),100)},c}(Array),h=function(b){var c,d,e;null==b&&(b={}),d=[];for(e in b)c=b[e],null!=c&&d.push(new a.FlashStruct(c,e));return d},i=function(a){return null==a?[]:h($.parseJSON(decodeURIComponent(a)))},c.prototype.process_static=function(){return this.stack.push_all(h(window.flashes)),delete window.flashes},c}(),a.listen_on=function(a){return null!=this.listener?this.listener:this.listener=new this.Listener(a)},jQuery(function(){return a.listen_on(this)})}).call(this);